<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Fpl-Gang-Planner</title>
	<link rel="stylesheet" type="text/css" href="css/index.css">
	<link rel="stylesheet" type="text/css" href="css/stats.css">
	<link rel="stylesheet" type="text/css" href="css/fixtures.css">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="icon" type="image/x-icon" href="/static/icons8.png">
	<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Montserrat+Alternates:wght@500&display=swap" rel="stylesheet"> 
	<link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet"> 
	<script defer type="text/javascript" src="js/players.js"></script>
	<script defer type="text/javascript" src="js/fixtures.js"></script>
</head>
<body>
	<nav id="myNav" class="topnav">
		<h4 class="logo">Fpl Gang</h4>
		<div class="links small">
			<a href="" id="team_id">Team ID</a>
		</div>
	</nav>
	<div class="playerpopup"></div>
	<div class="main">
		<div class="transfers-col">
			<div>
				<div class="details-one">
					<!--<div class="tteam">
						<div class="tname-details large slideshow">
							<span class="theading">Name</span>
							<h4 class="tname"></h4>
						</div>
						<div class="trank-details large slideshow">
							<span class="theading">Overall Rank</span>
							<h4 class="trank"></h4>
							<span id="grey_rank" class="new_ranks hide_rank">
								<svg xmlns="http://www.w3.org/2000/svg" fill="grey" height="48" width="48"><path d="M9.5 25.5q-.65 0-1.075-.425Q8 24.65 8 24q0-.65.425-1.075Q8.85 22.5 9.5 22.5h29q.65 0 1.075.425Q40 23.35 40 24q0 .65-.425 1.075-.425.425-1.075.425Z"/></svg>
							</span>
							<span id="red_rank" class="new_ranks hide_rank">
								<svg xmlns="http://www.w3.org/2000/svg" fill="red" height="48" width="48"><path d="m24 30-10-9.95h20Z"/></svg>
							</span>
							<span id="green_rank" class="new_ranks hide_rank">
								<svg xmlns="http://www.w3.org/2000/svg" fill="green" height="48" width="48"><path d="m14 28 10-10.05L34 28Z"/></svg>
							</span>
						</div>
						<div class="dots">
      						<span class="dot" onclick="currentHeader(0)"></span>
      						<span class="dot" onclick="currentHeader(1)"></span>
     						<span class="dot" onclick="currentHeader(2)"></span>
    					</div>
					</div>-->
					<div class="gw-buttonswrapper">
						<div class="gw-buttons">
							<button class="btn btn-fpl small prev_next" id="prevGameweek">
								<img src="./static/chevron_left.png" alt="prev_page">
							</button>
							<div id="deadline">
								<h4 id="gameweekNum" class="large"></h4>
								<div class="large">
									<h4 class="theading">Deadline In:</h4>
									<div class="ttime small">
										<div>
											<span id="day"></span><span>Days</span>
										</div>
										<div>
											<span id="hour"></span><span>Hrs</span>
										</div>
										<div>
											<span id="minute"></span><span>Mins</span>
										</div>
										<div>
											<span id="second"></span><span>Secs</span>
										</div>
									</div>
								</div>
							</div>
							<button class="btn btn-fpl small prev_next" id="nextGameweek">
								<img src="./static/chevron_right.png" alt="next_page">
							</button>
						</div>
					</div>
					<div class="budgetwrapper">
						<div class="budget">
							<div class="budget-players large">
								<h4 class="large">Player Selection</h4>
								<div><span class="player-num" ></span>&nbsp;<span>/</span>&nbsp;<span>15</span></div>
							</div>
							<div class="free-transfers large">
								<h4 title="Free Transfers large">FT</h4>
								<span class="transfer-number">N/A</span>
							</div>
							<div class="cost-transfers large">
								<h4 title="Transfer Cost large">TC</h4>
								<span class="points-lost">0</span>
							</div>
							<div class="remain large">
								<h4 class="large">Remaining Budget</h4>
								<span class="remain-budget">N/A</span>
							</div>
						</div>
					</div>
					<div class="btn-displayer">
						<div id="transfer" class="tab-item tab-border">
							<p class="large">Transfers</p>
						</div>
						<div id="chip" class="tab-item">
							<p class="large">Chips</p>
						</div>
					</div>
					<div id="transfer-tab"  class="upper-buttons button-item show">
						<button class="btn btn-block show-fpl btn-fpl small">Transfers</button>
						<button class="btn btn-block reset btn-fpl small">Reset</button>
						<!-- <button class="btn btn-block btn-auto">Autopick</button> -->
					</div>
					<div id="chip-tab"  class="chip-buttons button-item">
						<button class="btn btn-block btn-chip small" id="wcard">Wildcard</button>
						<button class="btn btn-block btn-chip small" id="bbench">Bench Boost</button>
						<button class="btn btn-block btn-chip small" id="tcap">Triple Captain</button>
						<button class="btn btn-block btn-chip small" id="fhit">Free Hit</button>
					</div>
					<div class="transfer-rows">
						<div class="transfer-out-wrapper">
							<h4 class="small">Transfer Out</h4>
							<div class="transfer-out"></div>
						</div>
						<div class="transfer-in-wrapper">
							<h4 class="small">Transfer In</h4>
							<div class="transfer-in"></div>
						</div>
					</div>
					<div class="message small"></div>
				</div>
				<div class="field">
					<div class="pitch">
						<div class="tname-details large">
							<span class="theading">Name</span>
							<h4 class="tname"></h4>
						</div>
						<div class="trank-details large">
							<span class="theading">Overall Rank</span>
							<div>
								<h4 class="trank"></h4>
								<div class="arrow">
								
							</div>
							</div>
						</div>
						<!-- GoalKeeper -->
						<div class="pitch_row" id="goal"  size="pitch">
						</div>
                        
                        <!-- Defenders -->

                        <div class="pitch_row" id="defend"  size="pitch">
							
						</div>

						<!-- Midfielders -->
						<div class="pitch_row" id="mid"   size="pitch">
							
						</div>

						<!-- Forwards -->
						<div class="pitch_row" id="forw"   size="pitch">
							
						</div>
					</div>
					<div class="bench" id="bench">
						<div class="bench_element">
						</div>
					</div>
				</div>
			</div>
			
		</div>
		<div class="players-col">
			<div class="players small">
		<div class="players-container">
			<div class="players-heading-container">
				<h3 class="players-heading">Player Selection</h3>
				<!--  <a href="#" class="players-heading-link">Back</a> -->
			</div>
			<div class="form">
				<form>
					<div class="view">
						<label>View</label>
						<select class="custom-select small" id="view_by">
							<optgroup label="Global">
								<option value="all players">All Players</option>
							</optgroup>
						</select>
					</div>
					<div class="sort">
						<label>Sorted by</label>
						<select class="custom-select" id="sort_by">
							<option value="total_points">Total points</option>
							<!-- <option value="event_points">Round points</option> -->
							<option value="now_cost">Price</option>
							<!-- <option>Team selected by %</option>
							<option>Minutes played</option>
							<option>Goals scored</option>
							<option>Assists</option>
							<option>Clean sheets</option>
							<option>Goals conceded</option>
							<option>Own goals</option>
							<option>Penalties saved</option>
							<option>Penalties missed</option>
							<option>Yellow cards</option>
							<option>Red cards</option>
							<option>Saves</option>
							<option>Points per match</option>
							<option>Transfers in</option>
							<option>Transfers out</option>
							<option>Transfers in(round)</option>
							<option>Transfers out(round)</option>
							<option>Price rise</option>
							<option>Price fall</option>
							<option>Price rise(round)</option>
							<option>Price fall(round)</option> -->
						</select>
					</div>
					<div class="search">
						<label>Search</label>
						<input id="search" class="blur" type="text" name="">
					</div>
					<div class="cost">
						<label>Max cost</label>
						<div>Between <span id="pMin"></span> and <span id="pMax"></span></div>
						<select class="custom-select">
						</select>
					</div>
				</form>
			</div>
		</div>
	</div>


	<!-- Player Info -->
	<div class="player-info">
		<div class="player-numbers">
			<span class="number"></span>
			<span class="numbers"></span>
		</div>
		<div class="players-table small">
			<table id="goalkeepers" class="table-one">
				<thead>
					<tr>
						<th></th>
						<th class="position-table">Goalkeepers</th>
						<th>£</th>
						<th>Points</th>
					</tr>
				</thead>
				<tbody>
					<tr><td colspan="4"><i>Loading...</i></td></tr>
				</tbody>
			</table>
			<table id="defenders" class="table-one">
				<thead>
					<tr>
						<th></th>
						<th class="position-table">Defenders</th>
						<th>£</th>
						<th>Points</th>
					</tr>
				</thead>
				<tbody>
					<tr><td colspan="4"><i>Loading...</i></td></tr>
				</tbody>
			</table>
			<table id="midfielders" class="table-one">
				<thead>
					<tr>
						<th></th>
						<th class="position-table">Midfielders</th>
						<th>£</th>
						<th>Points</th>
					</tr>
				</thead>
				<tbody>
					<tr><td colspan="4"><i>Loading...</i></td></tr>
				</tbody>
			</table>
			<table id="forwards" class="table-one">
				<thead>
					<tr>
						<th></th>
						<th class="position-table">Forwards</th>
						<th>£</th>
						<th>Points</th>
					</tr>
				</thead>
				<tbody>
					<tr><td colspan="4"><i>Loading...</i></td></tr>
				</tbody>
			</table>
		</div>
		<div class="button-controls">
			<button class="btn btn-controls" id="firstPage">
				<img src="./static/first_page.png" alt="first_page">
			</button>
			<button class="btn btn-controls" id="prevButton">
				<img src="./static/chevron_left.png" alt="prev_page">
			</button>
			<div class="pages">
				<span class="current"></span>
				<span>of</span>
				<span class="total_pages"></span>
			</div>
			<button class="btn btn-controls" id="nextButton">
				<img src="./static/chevron_right.png" alt="next_page">
			</button>
			<button class="btn btn-controls" id="lastPage">
				<img src="./static/last_page.png" alt="last_page">
			</button>
		</div>
	</div>
		</div>
	</div>
		<div class="fixtures-col">
			<h4 class="large fixture-heading">Fixture Ticker</h4>
			<div class="fixture-ticker">
				<table class="ticker-table">
					
				</table>
			</div>
		</div>
		<!--<div class="table-col">
			<h4>Table</h4>
		</div>-->

	<footer class="footer small">
		<div class="social-icons">
			<a href="https://www.twitter.com/lil_meezy1992" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="aqua" class="bi bi-twitter" viewBox="0 0 16 16">
  <path d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z"/>
</svg></a>
		</div>
		<p>Copyright &copy Fpl Captain 2022</p>
	</footer>
	<div id="modal" class="hide_modal">
		<form name="team">
			<label for="team">Team ID</label>
			<input type="number" id="teamid" required>
			<button type="submit" class="btn btn-block btn-fpl">Load</button>
		</form>
		<button class="btn-info btn-close btn-danger" id="close_modal">X</button>
	</div>
	
	<script type="text/javascript">

		let teamId = document.getElementById('team_id')
		let closeModal = document.getElementById('close_modal')
		let playerId
		let showModal = false
		const picks = []
   		const oldTeam = []
		closeModal.onclick = function() {
			showModal = false
			modal.classList.remove('show_modal')
			modal.classList.add('hide_modal')
			document.querySelector('.playerpopup').style.display = 'none'
		}
		
		teamId.onclick = function(e) {
			e.preventDefault()
			showModal = !showModal
			if(showModal) {
				modal.classList.add('show_modal')
				modal.classList.remove('hide_modal')
				modal.style.top = `${((window.innerHeight - modal.clientHeight)/2)}px`
				modal.style.left = `${((window.innerWidth - modal.clientWidth)/2)}px`
				document.querySelector('.playerpopup').style.display = 'block'
			}
			if(!showModal) {
				modal.classList.remove('show_modal')
				modal.classList.add('hide_modal')
				document.querySelector('.playerpopup').style.display = 'none'
			}
		}
		window.onresize = function() {
			if(showModal) {
				modal.style.top = `${((window.innerHeight - modal.clientHeight)/2)}px`
				modal.style.left = `${((window.innerWidth - modal.clientWidth)/2)}px`
			}
		}
		document.addEventListener('scroll', changeLogo, false)
		function changeLogo(){
			if(scrollY >= 100) {
				document.querySelector('.logo').innerHTML = document.querySelector('.tname').innerHTML
				//document.querySelector('.tname').innerHTML = 'TEAM NAME'
				//document.querySelector('.trank').innerHTML = 'OVERALL RANK'
			} else {
				document.querySelector('.logo').innerHTML = 'Fpl Gang'
			}
		}

		document.forms.team.onsubmit = function(e) {
			e.preventDefault()
			document.querySelector('.playerpopup').innerHTML = ''
			document.querySelector('.playerpopup').style.display = 'none'
			modal.classList.remove('show_modal')
			modal.classList.add('hide_modal')
			playerId = teamid.value
			getManagerInfo()
			redOrGreen()
			getManagerHistory()
			getManagerPicks()
			playersOut.length = 0
			playersIn.length = 0
			teamid.value = ""
		}

		

		//Get Manager Picks
		function getManagerPicks() {
			//let eventId = Math.max(...eventIds)
			eventztream = JSON.parse(sessionStorage.getItem('events'))
			filteredEvents = eventztream.filter(x => new Date(x.deadline_time) < new Date())
			eventId = filteredEvents.length
			var requestOptions = {
			method: 'GET',
			redirect: 'follow'
			};
			let buyingPrice
			fetch(`https://corsproxy.io/?https://fantasy.premierleague.com/api/entry/${playerId}/transfers/`, requestOptions)
			.then(response => response.json())
			.then(data => {
				return fetch(`https://corsproxy.io/?https://fantasy.premierleague.com/api/entry/${playerId}/event/${eventId}/picks/`, requestOptions)
				.then(response => response.json())
				.then(result => {
				let eventztream = JSON.parse(sessionStorage.getItem('events'))
				let filteredEvents = eventztream.filter(x => new Date(x.deadline_time) > new Date())

				let newPicks = []
   				const realPicks = []
   				let newPicksHyp = []
   				const realPicksHyp = []
				let gameweekPicks = []
				const transferPlayers = []
				let bank, value
				//console.log(result.picks)
				result.picks.forEach(x => {
					data.forEach(y => {
						if(x.element === y.element_in) {
							//Removing duplicate entries
							let isFound = transferPlayers.some(player => player.element === y.element_in)
							if(isFound) {
								return;
							} else {
								transferPlayers
							.push({element:y.element_in, element_in_cost:y.element_in_cost})
						}
						}
					})
				})

				result.picks.forEach(x => {
					playerState.players.forEach(y => {
						if(y.id === x.element) {
							now_cost = (y.now_cost/10).toFixed(1)
							price_change = (y.cost_change_start/10).toFixed(1)
							newPicksHyp.push({...x, disabled:true, element_out:null, element_type:y.element_type, team:y.team, now_cost, price_change})
							realPicksHyp.push({...x, disabled:true,element_out:null, element_type:y.element_type, team:y.team, now_cost, price_change})
						}
					})
				})

        // Adding selling prices and buying prices to the picks
				newPicksHyp.forEach(x => {
					let isFound = transferPlayers.some(player => player.element === x.element)
					if(isFound) {
						let element_in_cost = transferPlayers.find(player => player.element === x.element).element_in_cost
						formattedCost = (element_in_cost/10).toFixed(1)
						profit = +((+x.now_cost - +formattedCost).toFixed(1))
						actualProfit = (profit*10) % 2 === 0 ? 'even' : 'odd'
						if(actualProfit === 'even') {
							if(+profit < 0 ) {
								selling_price = (+(+(profit).toFixed(2).slice(0,4)) + +formattedCost).toFixed(1)
							} else {
							selling_price = (+((+profit/2).toFixed(1)) + +formattedCost).toFixed(1)
						}
						} else {
							if(+profit < 0 ) {
								selling_price = (+(+(profit).toFixed(2).slice(0,4)) + +formattedCost).toFixed(1)
							}
								else {
							selling_price = (+(+(profit/2).toFixed(2).slice(0,3)) + +formattedCost).toFixed(1)
						}
						}
						newPicks.push({...x, selling_price, element_in_cost:formattedCost})
					} else {
						formattedCost = (+x.now_cost - +x.price_change).toFixed(1)
						profit = +((+x.now_cost - +formattedCost).toFixed(1))
						actualProfit = (profit*10) % 2 === 0 ? 'even' : 'odd'
						//profit = ((+x.now_cost - +formattedCost)/2).toFixed(1)
						if(actualProfit === 'even') {
							if(+profit < 0 ) {
								selling_price = (+(+(profit).toFixed(2).slice(0,4)) + +formattedCost).toFixed(1)
							} else {
							selling_price = (+((+profit/2).toFixed(1)) + +formattedCost).toFixed(1)
						}
						} else {
							if(+profit < 0 ) {
								selling_price = (+(+(profit).toFixed(2).slice(0,4)) + +formattedCost).toFixed(1)
							}
								else {
							selling_price = (+(+(profit/2).toFixed(2).slice(0,3)) + +formattedCost).toFixed(1)
						}
						}
						/*selling_price = +profit < 0.1 && +profit >= 0 ? (+formattedCost).toFixed(1) :
										+profit < 0 ? (+x.now_cost).toFixed(1) : 
										(+formattedCost + +profit).toFixed(1)*/
						newPicks.push({...x, selling_price, element_in_cost:formattedCost})
					}
				})

        /* Adding selling prices and buying prices to picks to be used on reset for
         the first gw in the ui */
				realPicksHyp.forEach(x => {
					let isFound = transferPlayers.some(player => player.element === x.element)
					if(isFound) {
						let element_in_cost = transferPlayers.find(player => player.element === x.element).element_in_cost
						formattedCost = (element_in_cost/10).toFixed(1)
						profit = ((+x.now_cost - +formattedCost)/2).toFixed(1)
						selling_price = +profit < 0.1 && +profit >= 0 ? (+formattedCost).toFixed(1) :
										+profit < 0 ? (+x.now_cost).toFixed(1) : 
										(+formattedCost + +profit).toFixed(1)
						realPicks.push({...x, selling_price, element_in_cost:formattedCost})
					} else {
						formattedCost = (+x.now_cost - +x.price_change).toFixed(1)
						profit = ((+x.now_cost - +formattedCost)/2).toFixed(1)
						selling_price = +profit < 0.1 && +profit >= 0 ? (+formattedCost).toFixed(1) :
										+profit < 0 ? (+x.now_cost).toFixed(1) : 
										(+formattedCost + +profit).toFixed(1)
						realPicks.push({...x, selling_price, element_in_cost:formattedCost})
					}
				})
				bank = (result.entry_history.bank/10).toFixed(1)
				value = (result.entry_history.value/10).toFixed(1)
                let totalBudget = newPicks.reduce((x,y) => x+(+y.selling_price),0) + +bank
				filteredEvents.forEach((x, key) => {
					const { id, name, deadline_time } = x
					//Adding picks to first GW only
					const brandNewPicks = key === 0 ? newPicks : []
					const newResult = {id, name, deadline_time, newPicks:brandNewPicks, totalBudget, bank, value, transfers:[{"transfersOut":[]}, {"transfersIn":[]}] }
					gameweekPicks.push(newResult)
				})

				
				sessionStorage.removeItem('managerPicks')
				sessionStorage.setItem('managerPicks', JSON.stringify(gameweekPicks))
				sessionStorage.removeItem('realPicks')
				sessionStorage.setItem('realPicks', JSON.stringify(realPicks))
				
				loadGameweeks().loadGameweek()
			})
			.catch(error => console.log('error', error));
			})
		}

		//Get Manager History
		function getManagerHistory() {
			var requestOptions = {
			method: 'GET',
			redirect: 'follow'
			};

			fetch(`https://corsproxy.io/?https://fantasy.premierleague.com/api/entry/${playerId}/history/`, requestOptions)
			.then(response => response.json())
			.then(result => {
				let eventztream = JSON.parse(sessionStorage.getItem('events'))
				let filteredEvents = eventztream.filter(x => new Date(x.deadline_time) > new Date())
				const { current, chips } = result
				let wildcard = chips.some(x => x.name === 'wildcard') ? true : false
				let bboost = chips.some(x => x.name === 'bboost') ? true : false
				let freehit = chips.some(x => x.name === 'freehit') ? true : false
				let tcap = chips.some(x => x.name === '3xc') ? true : false
				let wEvent = wildcard === true ? chips.filter(x => x.name === 'wildcard')[0].event : null
				let bEvent = bboost === true ? chips.filter(x => x.name === 'bboost')[0].event : null
				let fEvent = freehit === true ? chips.filter(x => x.name === 'freehit')[0].event : null
				let tEvent = tcap === true ? chips.filter(x => x.name === '3xc')[0].event : null
				let fts = 1
				returnFt(1, current.length, fts)
				rolledft = fts === 1 ? false : 2
				function returnFt(a, b, c) {
					if(a === b) {
						fts = c
						//console.log(fts)
						return;
					}
					if(current[a].event_transfers === 0 && current[a].event !== wEvent) {
						//console.log(`saved ${current[a].event}`)
						c = 2
					}
					if(current[a].event_transfers === 0 && current[a].event === wEvent) {
						//console.log(`not saved ${current[a].event}`)
						c = 1
					}
					if(current[a].event_transfers === 0 && current[a].event === fEvent) {
						//console.log(`not saved ${current[a].event}`)
						c = 1
					}
					if(current[a].event_transfers > 1) {
						//console.log(`not saved ${current[a].event}`)
						c = 1
					}
					if(current[a].event_transfers === 1 && c === 1) {
						//console.log(`not saved ${current[a].event}`)
						c = 1
					}
					if(current[a].event_transfers === 1 && c === 2) {
						//console.log(`saved 2 ${current[a].event}`)
						c = 2
					}
					a+=1
					returnFt(a, b, c)
				}
				const newManagerHistory = []
				const newHistory = {
					tc: 0,
					fts,
					rolledft,
					wildcard:{is_used:wildcard,event:wEvent},
					bboost:{is_used:bboost, event:bEvent}, 
					freehit:{is_used:freehit, event:fEvent}, 
					tcap:{is_used:tcap, event:tEvent}}
				filteredEvents.forEach(x => {
					const { id, name, deadline_time } = x
					const newResult = {id, name, deadline_time, ...newHistory }
					newManagerHistory.push(newResult)
				})	

				document.querySelector('.transfer-number').innerHTML = fts	

				sessionStorage.removeItem('managerHistory')
				sessionStorage.setItem('managerHistory', JSON.stringify(newManagerHistory))
				sessionStorage.setItem('realHistory', JSON.stringify(newManagerHistory))
				let retrievedHistory = JSON.parse(sessionStorage.getItem('managerHistory'))
				loadGameweeks().loadGameweek()
				setInterval(getTime, 100)
			})
			.catch(error => console.log('error', error));
		}

		//Get Manager Info
		function getManagerInfo() {
			var requestOptions = {
			method: 'GET',
			redirect: 'follow'
			};

			fetch(`https://corsproxy.io/?https://fantasy.premierleague.com/api/entry/${playerId}/`, requestOptions)
			.then(response => response.json())
			.then(result => {
				sessionStorage.removeItem('managerInfo')
				sessionStorage.setItem('managerInfo', JSON.stringify(result))
				let retrievedManager = JSON.parse(sessionStorage.getItem('managerInfo'))
				document.querySelector('.tname').innerHTML = retrievedManager.name
				document.querySelector('.trank').innerHTML = retrievedManager.summary_overall_rank
				
			})
			.catch(error => console.log('error', error));
		}

		
		

		//set player Data
		function setPlayerData(a) {
			var requestOptions = {
			method: 'GET',
			redirect: 'follow'
			};
			fetch(`https://corsproxy.io/?https://fantasy.premierleague.com/api/element-summary/${a}/`, requestOptions)
			.then(response => response.json())
			.then(data => {
				let result = ''
				let history = data.history
				history.map(x => {
					let hTeam = teamState.teams.find(tname => tname.id === x.opponent_team).name
					let home =  x.was_home ? 'H':'A'
					let row =  `<tr><td class='table-sticky'>${x.round}</td>
					<td class='table-sticky-1'>${hTeam}&nbsp;&nbsp;(${home}) </td>
					<td>${x.team_h_score} : ${x.team_a_score}</td>
					<td>${x.minutes}</td>
					<td>${x.total_points}</td>
					<td>${x.goals_scored}</td>
					<td>${x.assists}</td>
					<td>${x.clean_sheets}</td>
					</tr>`
					result += row
				})
				document.querySelector('.games-info-results tbody').innerHTML = result
			})
		}


		window.onload = function() {
			let retrievedManager = JSON.parse(sessionStorage.getItem('managerInfo'))
			let retrievedColor = JSON.parse(sessionStorage.getItem('color'))
			let retrievedHistory = JSON.parse(sessionStorage.getItem('managerHistory'))
			let retrievedPicks = JSON.parse(sessionStorage.getItem('managerPicks'))
			let rTeams = JSON.parse(sessionStorage.getItem('teams'))
			let rElementTypes = JSON.parse(sessionStorage.getItem('element_types'))
			let rEvents = JSON.parse(sessionStorage.getItem('events'))
			let rFixtures = JSON.parse(sessionStorage.getItem('fixtures'))
			let rPlayers = JSON.parse(sessionStorage.getItem('players'))
			if(retrievedManager === null) {
				document.querySelector('.tname').innerHTML = 'TEAM NAME'
				document.querySelector('.trank').innerHTML = 'OVERALL RANK'
			} else {
				document.querySelector('.tname').innerHTML = retrievedManager.name
				document.querySelector('.trank').innerHTML = retrievedManager.summary_overall_rank
			}
			if(retrievedPicks === null) {
				console.log('Upload Picks')
			} else {
				let retrievedManager = JSON.parse(sessionStorage.getItem('managerInfo'))
				playerId = retrievedManager.id+''
				//getManagerPicks()
				//getManagerHistory()
				setInterval(getTime, 100)
			}
			if(retrievedHistory === null) {
				console.log(null)
			} else {
				console.log('do something')
			}

			if(retrievedColor === null) {
				console.log(null)
			} else {
				retrievedColor === 'green' ? riseInRank() : 
				retrievedColor === 'red' ? dropInRank() : sameRank()
			}
			if(JSON.parse(sessionStorage.getItem('managerInfo')) === null) {
        		console.log('Upload Team')
        	} else {
           		 console.log('Team Uploaded')
       		 }
			 if(rElementTypes==null || rTeams==null || rEvents==null || rFixtures==null || rPlayers==null) {
				return
			 } else {
			    setTeams() 
				setElementTypes()
				setEvents()
				setPlayers()
				setFixtures()
			 }
       		 
			 loadTeamFixtures()
			 upload().loadPrices()
			 upload().loadPlayers()
			 loadGameweeks().loadGameweek()
		}
		
		//Compare previous Gameweeks
		function redOrGreen() {
			var requestOptions = {
			method: 'GET',
			redirect: 'follow'
			};

			fetch(`https://corsproxy.io/?https://fantasy.premierleague.com/api/entry/${playerId}/history/`, requestOptions)
			.then(response => response.json())
			.then(result => {
				sessionStorage.removeItem('color')
				let gwCurrent = result.current[result.current.length -1].overall_rank
				let gwPrevious = result.current[result.current.length -2].overall_rank
				if(gwCurrent < gwPrevious) {
					riseInRank()
					sessionStorage.setItem('color', JSON.stringify('green'))
				} else if(gwCurrent > gwPrevious) {
					dropInRank()
					sessionStorage.setItem('color', JSON.stringify('red'))
				} else {
					sameRank()
					sessionStorage.setItem('color', JSON.stringify('grey'))
				}
			})
			.catch(error => console.log('error', error));
		}
		arrowColor = document.querySelector('.arrow')
		function riseInRank() {
			arrowColor.innerHTML = `
									<svg xmlns="http://www.w3.org/2000/svg" fill="green" height="24" width="24"><path d="m7 14 5-5.025L17 14Z"/></svg>`
		}
		function dropInRank() { 
			arrowColor.innerHTML = `
									<svg xmlns="http://www.w3.org/2000/svg" fill="red" height="24" width="24"><path d="m12 15-5-4.975h10Z"/></svg>`
		}
		function sameRank() {
			arrowColor.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="grey" class="bi bi-circle-fill" viewBox="0 0 12 12">
  <circle cx="6" cy="6" r="6"/>
</svg>`
		}

	    function getTime() {
	        let retrievedGameweeks = JSON.parse(sessionStorage.getItem('managerPicks'))
			if(retrievedGameweeks === null) return
	        let currentWeek = retrievedGameweeks.filter(x => x.id === weekNdeadline[1])
	        let deadline = currentWeek[0].deadline_time
	        let millis = new Date(deadline)-new Date()
	        let seconds = Math.floor(millis/1000)
	        let formattedseconds = seconds >= 60 ? seconds%60 : seconds
	        newseconds = formattedseconds <= 9 ? `0${formattedseconds}` : formattedseconds
	        let minutes = Math.floor(seconds/60)
	        let formattedminutes = minutes >= 60 ? minutes%60 : minutes
	        newminutes = formattedminutes <= 9 ? `0${formattedminutes}` : formattedminutes
	        let hours = Math.floor(minutes/60)
	        let formattedhours = hours >= 24 ? hours%24 : hours
	        newhours = formattedhours <= 9 ? `0${formattedhours}` : formattedhours
	        let days = Math.floor(hours/24)
	        newdays = days <= 9 ? `0${days}` : days
	        if(millis <= 0) {
	            day.innerHTML = '00'
	            hour.innerHTML = '00'
	            minute.innerHTML = '00'
	            second.innerHTML = '00'
	        } else {
	            day.innerHTML = newdays
	            hour.innerHTML = newhours
	            minute.innerHTML = newminutes
	            second.innerHTML = newseconds
	    }
	    }
		

		
		//Return Main Data
		
	</script>
	</script>
	<script defer type="text/javascript" src="js/tables.js"></script>
	<script type="text/javascript" src="js/index.js"></script>
	<script type="text/javascript" src="js/modal.js"></script>
	<script type="text/javascript" src="js/gameweeks.js"></script>
	<script type="text/javascript" src="js/chips.js"></script>
</body>
</html>

